{"version":3,"file":"p5-widget.js","mappings":"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","sources":["webpack://p5.js-widget/./lib/defaults.ts","webpack://p5.js-widget/webpack/bootstrap","webpack://p5.js-widget/./lib/p5-widget.ts"],"sourcesContent":["export const P5_VERSION = '1.9.4';\nexport const PREVIEW_WIDTH = 250;\nexport const HEIGHT = 350;\nexport const MAX_RUN_TIME = 1000;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import * as defaults from \"./defaults\";\n\nconst MY_FILENAME = 'p5-widget.js';\nconst IFRAME_FILENAME = 'p5-widget.html';\nconst IFRAME_STYLE = [\n  'width: 100%',\n  'background-color: white',\n  'border: 1px solid #ec245e',\n  'box-sizing: border-box'\n];\nconst AVOID_MIXED_CONTENT_WARNINGS = true;\n\nlet myScriptEl = getMyScriptEl() as HTMLScriptElement;\nlet myBaseURL = getMyBaseURL(myScriptEl.src);\nlet autoload = !myScriptEl.hasAttribute('data-manual');\nlet nextId = 1;\n\nfunction getMyBaseURL(url: string) {\n  let baseURL = url.slice(0, -MY_FILENAME.length);\n\n  if (AVOID_MIXED_CONTENT_WARNINGS) {\n    if (window.location.protocol === 'http:' && /^https:/.test(baseURL)) {\n      // Our script was loaded over HTTPS, but the embedding page is\n      // using HTTP. This is likely to result in mixed content warnings\n      // if e.g. the widget's sketch wants to load resources relative to\n      // the embedding page's URL, so let's just embed the widget over\n      // HTTP instead of HTTPS.\n\n      baseURL = baseURL.replace('https:', 'http:');\n    }\n  }\n\n  return baseURL;\n}\n\nfunction getMyScriptEl() {\n  return (\n    document.currentScript ||\n    document.querySelectorAll(\"script[src$='\" + MY_FILENAME + \"']\")[0]\n  );\n}\n\n// http://stackoverflow.com/a/7557433/2422398\nfunction isElementInViewport(el: HTMLElement) {\n  var rect = el.getBoundingClientRect();\n\n  return (\n    rect.bottom >= 0 &&\n    rect.right >= 0 &&\n    rect.top <= (window.innerHeight ||\n                 document.documentElement.clientHeight) &&\n    rect.left <= (window.innerWidth ||\n                  document.documentElement.clientWidth)\n  );\n}\n\nfunction getDataHeight(el: HTMLScriptElement) {\n  let height = parseInt(el.getAttribute('data-height'));\n\n  if (isNaN(height)) height = defaults.HEIGHT;\n\n  return height;\n}\n\nfunction absoluteURL(url: string) {\n  let a = document.createElement('a');\n  a.setAttribute('href', url);\n\n  return a.href;\n}\n\nfunction getSketch(url: string, cb: (sketch: string) => any) {\n  let error = (msg?: any) => {\n    let lines = ['// p5.js-widget failed to retrieve ' + url + '.'];\n\n    if (msg && typeof(msg) == 'string') {\n      lines.push('// ' + msg);\n    }\n\n    cb(lines.join('\\n'));\n  };\n  let req = new XMLHttpRequest();\n  req.open('GET', url);\n\n  req.onload = () => {\n    if (req.status == 200) {\n      cb(req.responseText);\n    } else {\n      error('Server returned HTTP ' + req.status + '.');\n    }\n  };\n\n  req.onerror = error;\n  req.send(null);\n}\n\nfunction replaceScriptWithWidget(el: HTMLScriptElement) {\n  let iframe = document.createElement('iframe');\n  let height = getDataHeight(el);\n  let previewWidth = parseInt(el.getAttribute('data-preview-width'));\n  let baseSketchURL = absoluteURL(el.getAttribute('data-base-url'));\n  let p5version = el.getAttribute('data-p5-version');\n  let maxRunTime = parseInt(el.getAttribute('data-max-run-time'));\n  let autoplay = el.hasAttribute('data-autoplay');\n  let url;\n  let qsArgs = [\n    'id=' + encodeURIComponent(el.getAttribute('data-id'))\n  ];\n  let style = IFRAME_STYLE.slice();\n\n  function makeWidget(sketch: string) {\n    qsArgs.push('sketch=' + encodeURIComponent(sketch));\n    style.push('min-height: ' + height + 'px');\n    url = myBaseURL + IFRAME_FILENAME + '?' + qsArgs.join('&');\n    iframe.setAttribute('src', url);\n    iframe.setAttribute('style', style.join('; '));\n    el.parentNode.replaceChild(iframe, el);\n  }\n\n  if (!isNaN(previewWidth) && previewWidth >= 0) {\n    qsArgs.push('previewWidth=' + previewWidth);\n  }\n\n  if (!isNaN(maxRunTime) && maxRunTime >= 0) {\n    qsArgs.push('maxRunTime=' + maxRunTime);\n  }\n\n  if (baseSketchURL) {\n    qsArgs.push('baseSketchURL=' + encodeURIComponent(baseSketchURL));\n  }\n\n  if (p5version) {\n    qsArgs.push('p5version=' + encodeURIComponent(p5version));\n  }\n\n  if (autoplay) {\n    qsArgs.push('autoplay=on');\n  }\n\n  if (el.src && el.textContent && el.textContent.trim()) {\n    return makeWidget([\n      '// Your widget includes both a \"src\" attribute and inline script',\n      '// content, which makes no sense. Please remove one of them.'\n    ].join('\\n'));\n  }\n\n  if (el.src) {\n    getSketch(el.src, makeWidget);\n  } else {\n    makeWidget(el.textContent);\n  }\n}\n\nfunction whenVisible(el: HTMLScriptElement,\n                     cb: (el: HTMLScriptElement) => void) {\n  let CHECK_INTERVAL_MS = 1000;\n  let interval: NodeJS.Timeout;\n\n  function maybeMakeVisible() {\n    if (!isElementInViewport(el)) return;\n\n    clearInterval(interval);\n    window.removeEventListener('scroll', maybeMakeVisible, false);\n    window.removeEventListener('resize', maybeMakeVisible, false);\n    cb(el);\n  }\n\n  // We want to check at a fixed interval as a fallback, to make\n  // sure that we detect when the element is visible even outside\n  // of the usual means (e.g., because the user did some\n  // sort of pinch/zoom gesture).\n  interval = setInterval(maybeMakeVisible, 1000);\n\n  window.addEventListener('scroll', maybeMakeVisible, false);\n  window.addEventListener('resize', maybeMakeVisible, false);\n  maybeMakeVisible();\n}\n\nfunction lazilyReplaceScriptWithWidget(el: HTMLScriptElement) {\n  let height = getDataHeight(el);\n\n  el.style.display = 'block';\n  el.style.fontSize = '0';\n  el.style.width = '100%';\n  el.style.minHeight = height + 'px';\n  el.style.background = '#f0f0f0';\n\n  if (!el.hasAttribute('data-id')) {\n    el.setAttribute('data-id', nextId.toString());\n    nextId++;\n  }\n\n  whenVisible(el, replaceScriptWithWidget);\n}\n\nfunction lazilyReplaceAllScriptsWithWidget() {\n  let scripts = document.querySelectorAll(\"script[type='text/p5']\");\n\n  [].slice.call(scripts).forEach((el: HTMLScriptElement) => {\n    lazilyReplaceScriptWithWidget(el);\n  });\n}\n\nif (autoload) {\n  if (document.readyState === 'complete') {\n    lazilyReplaceAllScriptsWithWidget();\n  } else {\n    window.addEventListener(\n      'load',\n      lazilyReplaceAllScriptsWithWidget,\n      false\n    );\n  }\n}\n\nwindow['p5Widget'] = {\n  baseURL: myBaseURL,\n  url: myBaseURL + MY_FILENAME,\n  replaceScript: lazilyReplaceScriptWithWidget,\n  replaceAll: lazilyReplaceAllScriptsWithWidget,\n  defaults: defaults\n};\n"],"names":["P5_VERSION","PREVIEW_WIDTH","HEIGHT","MAX_RUN_TIME","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","url","baseURL","MY_FILENAME","IFRAME_FILENAME","IFRAME_STYLE","myScriptEl","document","currentScript","querySelectorAll","myBaseURL","src","slice","window","location","protocol","test","replace","autoload","hasAttribute","nextId","getDataHeight","el","height","parseInt","getAttribute","isNaN","defaults","replaceScriptWithWidget","iframe","createElement","previewWidth","baseSketchURL","a","setAttribute","href","absoluteURL","p5version","maxRunTime","autoplay","qsArgs","encodeURIComponent","style","makeWidget","sketch","push","join","parentNode","replaceChild","textContent","trim","cb","error","msg","lines","req","XMLHttpRequest","open","onload","status","responseText","onerror","send","getSketch","lazilyReplaceScriptWithWidget","display","fontSize","width","minHeight","background","toString","interval","maybeMakeVisible","rect","getBoundingClientRect","bottom","right","top","innerHeight","documentElement","clientHeight","left","innerWidth","clientWidth","isElementInViewport","clearInterval","removeEventListener","setInterval","addEventListener","whenVisible","lazilyReplaceAllScriptsWithWidget","scripts","call","forEach","readyState","replaceScript","replaceAll"],"sourceRoot":""}