(()=>{"use strict";var t={5339:(t,e,r)=>{function n(t,e="Error"){if(!t)throw new Error(e)}r.r(e),r.d(e,{Cell:()=>d,Cells:()=>l,Coordinates:()=>a,Direction:()=>c,Directions:()=>u,Grid:()=>f,Kara:()=>p,KaraRecorder:()=>g,KaraStepper:()=>m,KaraWorld:()=>v});class o extends Error{constructor(t){super(t),this.name=this.constructor.name}}class s extends Error{constructor(t){super(t),this.name=this.constructor.name}}const i=[8,8];class a{static fromXy(t,e){return new a(t,e)}static fromCopy(t){return new a(t.x,t.y)}constructor(t,e){this.x=t,this.y=e}add(t){return a.fromXy(this.x+t.x,this.y+t.y)}move(t){return t.apply(this)}toString(){return`[${this.x}, ${this.y}]`}}class c{constructor(t,e,r,n){this.name=t,this.coords=a.fromXy(e,r),this.angle=n}apply(t){return t.add(this.coords)}toString(){return this.name}}const u=function(){let t=new c("‚Üë",0,-1,0),e=new c("‚Üì",0,1,Math.PI),r=new c("‚Üí",1,0,Math.PI/2),n=new c("‚Üê",-1,0,-Math.PI/2);return t.left=n,t.right=r,n.left=e,n.right=t,e.left=r,e.right=n,r.left=t,r.right=e,Object.freeze({UP:t,DOWN:e,RIGHT:r,LEFT:n})}();class d{static fromString(t){switch(t){case" ":case"_":return l.EMPTY;case"T":case"üå≥":return l.TREE;case"B":case"üêû":return l.BUG;case"M":case"üçÑ":return l.MUSHROOM;case"C":case"üçÄ":return l.CLOVER;default:return new d(t,t)}}constructor(t="?",e=EMPTY){this.display=t,this.type=e}draw(t,e){text(this.display,t,e)}toString(){return this.type}}const l=Object.freeze({EMPTY:new d(" ","_"),TREE:new d("üå≥","T"),BUG:new d("üêû","B"),MUSHROOM:new d("üçÑ","M"),CLOVER:new d("üçÄ","C")}),h="TTTTTTTTT\n   T       T\n   T       T\n   T       T\n   T       T\n   T       T\n   T       T\n   T       T\n   TTTTTTTTT";class f{static copy(t){return f.fromStringSpec(t.toString())}static fromStringSpec(t){let e=t.split(/\r?\n/g);for(let t=0;t<e.length;t++)e[t]=e[t].trim();return f.fromStringArray(e)}static fromStringArray(t){let e=[...t[0]].length,r=t.length,o=new f([e,r]),s=0;for(let r of t){n([...r].length==e,`Unexpected grid spec, line ${s} has length ${[...r].length}, expected ${e} `);let t=0;for(let e of r){let r=d.fromString(e),n=a.fromXy(t,s);o.set(n,r),t++}s++}return o}constructor(t=i){n(t[0]>=1&&t[1]>=1,`unexpected grid size: ${t}`),this.size=[...t];let e=Array(this.size[0]).fill(l.EMPTY);this.grid=Array(this.size[1]);for(let t=0;t<this.grid.length;t++)this.grid[t]=Array.from(e)}findKara(){let t,e;for(let r=0;r<this.grid.length;r++){let n=this.grid[r];for(let o=0;o<n.length;o++){let n=a.fromXy(o,r),s=this.at(n);if(s!=l.EMPTY||e||(e=n),!t)switch(s.type){case"<":t=new p(this,n,u.LEFT);break;case"^":t=new p(this,n,u.UP);break;case">":t=new p(this,n,u.RIGHT);break;case"V":case"v":t=new p(this,n,u.DOWN)}switch(s.type){case"<":case"^":case">":case"V":case"v":this.clear(n)}}}return!t&&e&&(t=new p(this,e,c.RIGHT)),t}at(t){return this.grid[t.y][t.x]}set(t,e){this.grid[t.y][t.x]=e}clear(t){this.grid[t.y][t.x]=l.EMPTY}draw(t=25){push(),stroke("rgba(115,115,115,0.5)"),textAlign(CENTER,CENTER);for(let e=0;e<this.grid.length;e++){let r=this.grid[e];for(let n=0;n<r.length;n++){let r=this.at(a.fromXy(n,e));push(),translate(n*t,e*t),square(0,0,t),translate(.5*t,.5*t),r.draw(0,0),pop()}}pop()}gridSize(){return a.fromXy(this.grid[0].length,this.grid.length)}toString(){return this.grid.map((t=>t.map((t=>t.toString())).join(""))).join("\n")}}class p{constructor(t,e=a.fromXy(1,1),r=u.RIGHT,n=y.noSounds()){this.grid=t,this.direction=r,this.coords=a.fromCopy(e),this.sounds=n}draw(t){push(),translate((this.coords.x+.5)*t,(this.coords.y+.5)*t),rotate(this.direction.angle),textAlign(CENTER,CENTER),text(l.BUG.display,0,0),pop()}_cell(t){try{return this.grid.at(t)}catch(t){return}}treeFront(){return this._cell(this.direction.apply(this.coords))==l.TREE}treeLeft(){return this._cell(this.direction.left.apply(this.coords))==l.TREE}treeRight(){return this._cell(this.direction.right.apply(this.coords))==l.TREE}mushroomFront(){return this._cell(this.direction.apply(this.coords))==l.MUSHROOM}onLeaf(){return this._cell(this.coords)==l.CLOVER}_isMoveableDestination(t){let e=this._cell(t);return null!=e&&e!=l.TREE}_canMove(t=void 0){return t||(t=this.direction),this._isMoveableDestination(this.coords.move(t))}_checkSuccess(){this.mushroomFront()&&window.successSound&&window.successSound.play()}move(){if(!this._canMove())throw this.sounds.boing(),new o(`Unable to move from ${this.coords} in direction ${this.direction}!`);this.sounds.move(),this.coords=this.coords.move(this.direction),this.sounds.afterMove(this)}turnLeft(){this.sounds.turnLeft(),this.direction=this.direction.left,this.sounds.afterMove(this)}turnRight(){this.sounds.turnRight(),this.direction=this.direction.right,this.sounds.afterMove(this)}putLeaf(){this.sounds.putLeaf(),this.grid.set(this.coords,l.CLOVER)}removeLeaf(){this.sounds.removeLeaf(),this.grid.at(this.coords)==l.CLOVER&&this.grid.clear(this.coords)}}class m{constructor(t,e=500){this.kara=t,this.delay=e}sleeper(){return new Promise((t=>setTimeout((()=>t()),this.delay)))}treeFront(){return this.kara.treeFront()}treeLeft(){return this.kara.treeLeft()}treeRight(){return this.kara.treeRight()}mushroomFront(){return this.kara.mushroomFront()}onLeaf(){return this.kara.onLeaf()}async move(){await this.sleeper(),this.kara.move()}async turnLeft(){await this.sleeper(),this.kara.turnLeft()}async turnRight(){await this.sleeper(),this.kara.turnRight()}async putLeaf(){await this.sleeper(),this.kara.putLeaf()}async removeLeaf(){await this.sleeper(),this.kara.removeLeaf()}}class g{constructor(t,e=50){this.kara=t,this.commands=Array(),this.maxCommands=e}async replay(t){for(let e of this.commands)await t[e]()}record(t){if(this.commands.length>this.maxCommands)throw new s(`Stopped recording after ${this.maxCommands} commands.`);this.commands.push(t)}treeFront(){return this.kara.treeFront()}treeLeft(){return this.kara.treeLeft()}treeRight(){return this.kara.treeRight()}mushroomFront(){return this.kara.mushroomFront()}onLeaf(){return this.kara.onLeaf()}move(){this.record(this.move.name),this.kara.move()}turnLeft(){this.record(this.turnLeft.name),this.kara.turnLeft()}turnRight(){this.record(this.turnRight.name),this.kara.turnRight()}putLeaf(){this.record(this.putLeaf.name),this.kara.putLeaf()}removeLeaf(){this.record(this.removeLeaf.name),this.kara.removeLeaf()}}class y{static noSounds(){return new y}static mushroomGoal(){let t=new y;return t.preload=()=>{soundFormats("mp3","ogg"),t.stepSound=loadSound("/static/sounds/step2.mp3"),t.turnSound=loadSound("/static/sounds/turn.mp3"),t.successSound=loadSound("/static/sounds/goal.mp3"),t.boingSound=loadSound("/static/sounds/boing.mp3")},t.move=()=>{t.stepSound.play()},t.turnLeft=()=>{t.turnSound.play()},t.turnRight=t.turnLeft,t.afterMove=e=>{e.mushroomFront()&&t.successSound.play()},t.boing=()=>{t.boingSound.play()},t}preload(){}move(){}turnLeft(){}turnRight(){}putLeaf(){}removeLeaf(){}afterMove(t){}boing(){}}class v{static create(t=h,e=25,r=!0,n=!0){let o={install:r,keyhandler:n,cell_size:e};return this.fromOptions(t,o)}static fromOptions(t=h,e=v.DefaultOptions){e=Object.assign({},v.DefaultOptions,e);let r=v.fromStringSpec(t);if(e.install){const t=e.cell_size;let n=r.grid.gridSize();if(e.success_handler){let t=y.mushroomGoal();window.preload=()=>{t.preload()},r.kara.sounds=t}window.setup=()=>{createCanvas(n.x*t,n.y*t),r.executeKara(e.delay_ms,e.client_function,e.max_commands)},window.draw=()=>{r.draw(t)},window.kara=r.getRecorder()}return e.keyhandler&&(window.keyPressed=()=>r.keyPressed()),r.options=e,r}static fromStringSpec(t=h){let e=f.fromStringSpec(t);return new v(e,e.findKara())}constructor(t,e){this.grid=t,this.kara=e;let r=f.copy(this.grid),n=Object.create(this.kara);n.sounds=y.noSounds(),n.grid=r,this.recorder=new g(n)}draw(t){push(),this.options.success_handler&&this.options.success_handler.mushroomFront&&this.kara.mushroomFront()&&background(this.options.success_handler.background),textSize(.8*t),this.grid.draw(t),this.options.success_handler&&this.options.success_handler.mushroomFront&&this.kara.mushroomFront()&&textSize(1.5*t),this.kara.draw(t),pop()}getRecorder(){return this.recorder}async executeKara(t=500,e="my_kara",r=50){let n;this.recorder.maxCommands=r;try{"string"==typeof e&&(e=window[e]),"function"==typeof e?e(this.recorder):console.log(`Not a valid client function: ${e}`)}catch(t){(t instanceof o||t instanceof s)&&(n=t)}let i=new m(this.kara,t);return this.recorder.replay(i).catch((t=>{if(t instanceof o||t instanceof s)throw n}))}keyPressed(){return keyCode==UP_ARROW?(event&&event.preventDefault(),this.kara.move(),!1):keyCode==LEFT_ARROW?(event&&event.preventDefault(),this.kara.turnLeft(),!1):keyCode==RIGHT_ARROW?(event&&event.preventDefault(),this.kara.turnRight(),!1):keyCode==DOWN_ARROW?(event&&event.preventDefault(),this.kara.onLeaf()?this.kara.removeLeaf():this.kara.putLeaf(),!1):void 0}}v.DefaultOptions=Object.freeze({install:!0,keyhandler:!0,cell_size:25,delay_ms:500,max_commands:50,success_handler:{mushroomFront:!0,background:"#ff00ff",sound:!0}})},650:(t,e,r)=>{r.d(e,{A:()=>a});var n=r(1354),o=r.n(n),s=r(6314),i=r.n(s)()(o());i.push([t.id,"html, body {\n  height: 100%;\n}\n\nbody {\n  margin: 0;\n  display: flex;\n\n  /* This centers our sketch horizontally. */\n  justify-content: center;\n\n  /* This centers our sketch vertically. */\n  align-items: center;\n}\n","",{version:3,sources:["webpack://./css/preview-frame.css"],names:[],mappings:"AAAA;EACE,YAAY;AACd;;AAEA;EACE,SAAS;EACT,aAAa;;EAEb,0CAA0C;EAC1C,uBAAuB;;EAEvB,wCAAwC;EACxC,mBAAmB;AACrB",sourcesContent:["html, body {\n  height: 100%;\n}\n\nbody {\n  margin: 0;\n  display: flex;\n\n  /* This centers our sketch horizontally. */\n  justify-content: center;\n\n  /* This centers our sketch vertically. */\n  align-items: center;\n}\n"],sourceRoot:""}]);const a=i},6314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",n=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),n&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),n&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,n,o,s){"string"==typeof t&&(t=[[null,t,void 0]]);var i={};if(n)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(i[c]=!0)}for(var u=0;u<t.length;u++){var d=[].concat(t[u]);n&&i[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),r&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=r):d[2]=r),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),e.push(d))}},e}},1354:t=>{t.exports=function(t){var e=t[1],r=t[3];if(!r)return e;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),s="/*# ".concat(o," */");return[e].concat([s]).join("\n")}return[e].join("\n")}},6317:(t,e,r)=>{r.r(e),r.d(e,{default:()=>y});var n=r(5072),o=r.n(n),s=r(7825),i=r.n(s),a=r(7659),c=r.n(a),u=r(5056),d=r.n(u),l=r(540),h=r.n(l),f=r(1113),p=r.n(f),m=r(650),g={};g.styleTagTransform=p(),g.setAttributes=d(),g.insert=c().bind(null,"head"),g.domAPI=i(),g.insertStyleElement=h(),o()(m.A,g);const y=m.A&&m.A.locals?m.A.locals:void 0},5072:t=>{var e=[];function r(t){for(var r=-1,n=0;n<e.length;n++)if(e[n].identifier===t){r=n;break}return r}function n(t,n){for(var s={},i=[],a=0;a<t.length;a++){var c=t[a],u=n.base?c[0]+n.base:c[0],d=s[u]||0,l="".concat(u," ").concat(d);s[u]=d+1;var h=r(l),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)e[h].references++,e[h].updater(f);else{var p=o(f,n);n.byIndex=a,e.splice(a,0,{identifier:l,updater:p,references:1})}i.push(l)}return i}function o(t,e){var r=e.domAPI(e);return r.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,o){var s=n(t=t||[],o=o||{});return function(t){t=t||[];for(var i=0;i<s.length;i++){var a=r(s[i]);e[a].references--}for(var c=n(t,o),u=0;u<s.length;u++){var d=r(s[u]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}s=c}}},7659:t=>{var e={};t.exports=function(t,r){var n=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(r)}},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},5056:(t,e,r)=>{t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},7825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var n="";r.supports&&(n+="@supports (".concat(r.supports,") {")),r.media&&(n+="@media ".concat(r.media," {"));var o=void 0!==r.layer;o&&(n+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),n+=r.css,o&&(n+="}"),r.media&&(n+="}"),r.supports&&(n+="}");var s=r.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(n,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},1113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},2213:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&n(e,t,r);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const i=s(r(5339));r(6317);let a=window;a.startSketch=function(t,e,r,n,o,s){let c=document.createElement("script"),u=function(t,e,r){let n={wasTriggered:!1,getLineNumber(){let e=s[0],r=1;for(let n=0;n<e;n++)"\n"===t[n]&&r++;return r}},o=Date.now(),s=null;return a[e]=t=>{if(Date.now()-o>r)throw n.wasTriggered=!0,s=t,new Error("Loop took over "+r+" ms to run")},setInterval((()=>{o=Date.now()}),r/2),n}(t,n,r);var d,l,h;o&&(d=o,(l=document.createElement("base")).setAttribute("href",d),document.head.appendChild(l)),c.textContent=t,a.addEventListener("error",(t=>{let e,r=t.message;if(t.error&&(r=t.error.message),u.wasTriggered)r="Your loop is taking too long to run.",e=u.getLineNumber();else if(t.error&&t.error.stack){let r=t.error.stack.match(/my_kara \(<anonymous>:(\d+):\d+\)/);r&&r.length>1&&(e=parseInt(r[1]))}else"number"!=typeof t.lineno||""!==t.filename&&t.filename!==window.location.href||(e=t.lineno);s(r,e)})),a.addEventListener("unhandledrejection",(t=>{reportError(t.reason)})),function(t,e){e=e||(()=>{});let r=0,n=()=>{if(r===t.length)return e();!function(t,e){let r=document.createElement("script");e=e||(()=>{}),r.onload=e,r.onerror=()=>{console.log("Failed to load script: "+t)},r.setAttribute("src",t),document.body.appendChild(r)}(t[r++],n)};n()}([`//cdnjs.cloudflare.com/ajax/libs/p5.js/${h=e}/p5.js`,`//cdnjs.cloudflare.com/ajax/libs/p5.js/${h}/addons/p5.sound.min.js`],(()=>{!function(){for(let t of Object.keys(i))a[t]=i[t]}(),document.body.appendChild(c),"complete"===document.readyState&&new a.p5}))}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={id:n,exports:{}};return t[n].call(s.exports,s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.nc=void 0,r(2213)})();
//# sourceMappingURL=preview-frame.bundle.js.map